<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Gols - EMEF Pe Francisco Rieger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, updateDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Configura√ß√£o do Firebase (ser√° preenchida pelo usu√°rio)
        const firebaseConfig = {
            apiKey: "AIzaSyBdJ9odC_uVWaoAuQQhDtZRkR5GpjhY8UE",
            authDomain: "registro-gols-rieger.firebaseapp.com",
            projectId: "registro-gols-rieger",
            storageBucket: "registro-gols-rieger.firebasestorage.app",
            messagingSenderId: "141443336767",
            appId: "1:141443336767:web:8fe381ba05f8d61ed1868a"
        };
        
        // Inicializar Firebase
        let app, db;
        let firebaseEnabled = false;
        
        try {
            // Verificar se as configura√ß√µes foram preenchidas
            if (firebaseConfig.apiKey !== "SUA_API_KEY_AQUI") {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                firebaseEnabled = true;
                console.log('Firebase conectado com sucesso!');
                document.getElementById('firebaseStatus').innerHTML = 'üü¢ Firebase Conectado';
                document.getElementById('firebaseStatus').className = 'text-green-600 font-medium';
            } else {
                throw new Error('Configura√ß√£o do Firebase n√£o encontrada');
            }
        } catch (error) {
            console.log('Firebase n√£o configurado, usando armazenamento local');
            document.getElementById('firebaseStatus').innerHTML = 'üü° Modo Local (Configure Firebase)';
            document.getElementById('firebaseStatus').className = 'text-yellow-600 font-medium';
        }
        
        // Disponibilizar globalmente
        window.firebaseDB = { db, firebaseEnabled, addDoc, getDocs, deleteDoc, doc, collection, query, orderBy, updateDoc };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .trophy-gold { color: #FFD700; }
        .trophy-silver { color: #C0C0C0; }
        .trophy-bronze { color: #CD7F32; }
        
        @media print {
            @page {
                size: A4 landscape;
                margin: 1cm;
            }
            
            body {
                background: white !important;
                color: black !important;
                font-size: 12px;
            }
            
            .no-print {
                display: none !important;
            }
            
            .print-only {
                display: block !important;
            }
            
            .print-table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
            }
            
            .print-table th,
            .print-table td {
                border: 1px solid #000;
                padding: 8px;
                text-align: left;
                font-size: 11px;
            }
            
            .print-table th {
                background-color: #f0f0f0;
                font-weight: bold;
            }
            
            .print-header {
                text-align: center;
                margin-bottom: 20px;
            }
            
            .print-section {
                margin-bottom: 30px;
                page-break-inside: avoid;
            }
        }
        
        .print-only {
            display: none;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-green-800 mb-2">‚öΩ Registro de Gols</h1>
            <h2 class="text-xl text-green-600">EMEF Pe Francisco Rieger</h2>
            <p class="text-gray-600 mt-2">Educa√ß√£o F√≠sica - Controle de Goleadores</p>
            <div class="mt-4">
                <span id="firebaseStatus" class="text-yellow-600 font-medium">üîÑ Carregando...</span>
            </div>
        </div>

        <!-- Aviso de Configura√ß√£o Firebase -->
        <div id="firebaseWarning" class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 rounded-lg" style="display: none;">
            <div class="flex">
                <div class="flex-shrink-0">
                    <span class="text-yellow-400 text-xl">‚ö†Ô∏è</span>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-yellow-700">
                        <strong>Firebase n√£o configurado!</strong> Os dados est√£o sendo salvos apenas localmente. 
                        <a href="#" onclick="showFirebaseInstructions()" class="underline font-medium">Clique aqui para configurar o Firebase</a> 
                        e ter seus dados na nuvem.
                    </p>
                </div>
            </div>
        </div>

        <!-- Modal de Instru√ß√µes Firebase -->
        <div id="firebaseModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" style="display: none;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">üîß Como Configurar o Firebase</h3>
                    <div class="text-sm text-gray-700 space-y-3">
                        <p><strong>1.</strong> Acesse <a href="https://console.firebase.google.com" target="_blank" class="text-blue-600 underline">console.firebase.google.com</a></p>
                        <p><strong>2.</strong> Clique em "Criar um projeto" ou "Add project"</p>
                        <p><strong>3.</strong> D√™ um nome ao projeto (ex: "registro-gols-escola")</p>
                        <p><strong>4.</strong> Desabilite o Google Analytics (n√£o √© necess√°rio)</p>
                        <p><strong>5.</strong> Ap√≥s criar, clique no √≠cone da web (&lt;/&gt;) para adicionar um app</p>
                        <p><strong>6.</strong> D√™ um nome ao app e clique em "Register app"</p>
                        <p><strong>7.</strong> Copie as configura√ß√µes que aparecem e cole no c√≥digo</p>
                        <p><strong>8.</strong> V√° em "Firestore Database" no menu lateral</p>
                        <p><strong>9.</strong> Clique "Create database" > "Start in test mode" > "Next" > "Done"</p>
                        <div class="bg-gray-100 p-3 rounded mt-4">
                            <p class="font-medium">Substitua no c√≥digo as linhas:</p>
                            <code class="text-xs">
                                apiKey: "SUA_API_KEY_AQUI",<br>
                                authDomain: "SEU_PROJECT_ID.firebaseapp.com",<br>
                                projectId: "SEU_PROJECT_ID",<br>
                                // etc...
                            </code>
                        </div>
                    </div>
                    <div class="flex justify-end mt-6">
                        <button onclick="closeFirebaseModal()" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                            Fechar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Edi√ß√£o -->
        <div id="editModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" style="display: none;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">‚úèÔ∏è Editar Registro</h3>
                    
                    <form id="editForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="hidden" id="editRecordId">
                        <input type="hidden" id="editRecordType">
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data</label>
                            <input type="date" id="editDate" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" id="editNameLabel">Nome do Aluno</label>
                            <input type="text" id="editName" required placeholder="Digite o nome completo"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Naipe</label>
                            <select id="editGender" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="masculino">Masculino</option>
                                <option value="feminino">Feminino</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Turma</label>
                            <select id="editClass" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Selecione</option>
                                <option value="5A">5¬∫ A</option>
                                <option value="5B">5¬∫ B</option>
                                <option value="6A">6¬∫ A</option>
                                <option value="6B">6¬∫ B</option>
                                <option value="7A">7¬∫ A</option>
                                <option value="7B">7¬∫ B</option>
                                <option value="8A">8¬∫ A</option>
                                <option value="8B">8¬∫ B</option>
                                <option value="9A">9¬∫ A</option>
                                <option value="9B">9¬∫ B</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" id="editGoalsLabel">Quantidade de Gols</label>
                            <input type="number" id="editGoals" min="0" max="20" required placeholder="Ex: 3"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </form>
                    
                    <div class="flex justify-end mt-6 space-x-3">
                        <button onclick="closeEditModal()" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                            Cancelar
                        </button>
                        <button onclick="saveEdit()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                            üíæ Salvar Altera√ß√µes
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Formul√°rio de Registro -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h3 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                üìù Registrar Gols
            </h3>
            
            <form id="goalForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Data</label>
                    <input type="date" id="date" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Aluno</label>
                    <input type="text" id="studentName" required placeholder="Digite o nome completo"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Naipe</label>
                    <select id="gender" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        <option value="">Selecione</option>
                        <option value="masculino">Masculino</option>
                        <option value="feminino">Feminino</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Turma</label>
                    <select id="class" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        <option value="">Selecione</option>
                        <option value="5A">5¬∫ A</option>
                        <option value="5B">5¬∫ B</option>
                        <option value="6A">6¬∫ A</option>
                        <option value="6B">6¬∫ B</option>
                        <option value="7A">7¬∫ A</option>
                        <option value="7B">7¬∫ B</option>
                        <option value="8A">8¬∫ A</option>
                        <option value="8B">8¬∫ B</option>
                        <option value="9A">9¬∫ A</option>
                        <option value="9B">9¬∫ B</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Quantidade de Gols</label>
                    <input type="number" id="goals" min="1" max="20" required placeholder="Ex: 3"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                </div>
                
                <div class="flex items-end">
                    <button type="submit" 
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center justify-center">
                        ‚öΩ Registrar Gols
                    </button>
                </div>
            </form>
        </div>

        <!-- Registro de Goleiros -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h3 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                ü•Ö Registrar Gols Sofridos (Goleiros)
            </h3>
            
            <form id="goalkeeperForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Data</label>
                    <input type="date" id="gkDate" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Goleiro</label>
                    <input type="text" id="goalkeeperName" required placeholder="Digite o nome completo"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Naipe</label>
                    <select id="gkGender" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Selecione</option>
                        <option value="masculino">Masculino</option>
                        <option value="feminino">Feminino</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Turma</label>
                    <select id="gkClass" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Selecione</option>
                        <option value="5A">5¬∫ A</option>
                        <option value="5B">5¬∫ B</option>
                        <option value="6A">6¬∫ A</option>
                        <option value="6B">6¬∫ B</option>
                        <option value="7A">7¬∫ A</option>
                        <option value="7B">7¬∫ B</option>
                        <option value="8A">8¬∫ A</option>
                        <option value="8B">8¬∫ B</option>
                        <option value="9A">9¬∫ A</option>
                        <option value="9B">9¬∫ B</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Gols Sofridos</label>
                    <input type="number" id="goalsSuffered" min="0" max="20" required placeholder="Ex: 2"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div class="flex items-end">
                    <button type="submit" 
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 flex items-center justify-center">
                        ü•Ö Registrar Goleiro
                    </button>
                </div>
            </form>
        </div>

        <!-- Filtros e Impress√£o -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4">
                <h3 class="text-xl font-semibold text-gray-800">üîç Filtros</h3>
                <div class="flex flex-wrap gap-2">
                    <select id="printYearSelect" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                        <option value="">Ano para impress√£o</option>
                    </select>
                    <button onclick="printMonthlyReport()" 
                            class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200 flex items-center">
                        üñ®Ô∏è Imprimir Mensal
                    </button>
                    <button onclick="printAnnualReport()" 
                            class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200 flex items-center">
                        üñ®Ô∏è Imprimir Anual
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <select id="filterGender" class="px-3 py-2 border border-gray-300 rounded-lg">
                    <option value="">Todos os naipes</option>
                    <option value="masculino">Masculino</option>
                    <option value="feminino">Feminino</option>
                </select>
                
                <select id="filterClass" class="px-3 py-2 border border-gray-300 rounded-lg">
                    <option value="">Todas as turmas</option>
                    <option value="5A">5¬∫ A</option>
                    <option value="5B">5¬∫ B</option>
                    <option value="6A">6¬∫ A</option>
                    <option value="6B">6¬∫ B</option>
                    <option value="7A">7¬∫ A</option>
                    <option value="7B">7¬∫ B</option>
                    <option value="8A">8¬∫ A</option>
                    <option value="8B">8¬∫ B</option>
                    <option value="9A">9¬∫ A</option>
                    <option value="9B">9¬∫ B</option>
                </select>
                
                <select id="filterMonth" class="px-3 py-2 border border-gray-300 rounded-lg">
                    <option value="">Todos os meses</option>
                    <option value="1">Janeiro</option>
                    <option value="2">Fevereiro</option>
                    <option value="3">Mar√ßo</option>
                    <option value="4">Abril</option>
                    <option value="5">Maio</option>
                    <option value="6">Junho</option>
                    <option value="7">Julho</option>
                    <option value="8">Agosto</option>
                    <option value="9">Setembro</option>
                    <option value="10">Outubro</option>
                    <option value="11">Novembro</option>
                    <option value="12">Dezembro</option>
                </select>
                
                <select id="filterYear" class="px-3 py-2 border border-gray-300 rounded-lg">
                    <option value="">Todos os anos</option>
                </select>
            </div>
        </div>

        <!-- Rankings -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Ranking Mensal Goleadores -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    üìÖ Goleadores - Mensal
                </h3>
                <div id="monthlyRanking" class="space-y-3">
                    <p class="text-gray-500 text-center py-8">Nenhum registro encontrado para este m√™s</p>
                </div>
            </div>

            <!-- Ranking Anual Goleadores -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    üèÜ Goleadores - Anual
                </h3>
                <div id="annualRanking" class="space-y-3">
                    <p class="text-gray-500 text-center py-8">Nenhum registro encontrado para este ano</p>
                </div>
            </div>

            <!-- Ranking Goleiros Menos Vazados -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    ü•Ö Goleiros Menos Vazados
                </h3>
                <div id="goalkeeperRanking" class="space-y-3">
                    <p class="text-gray-500 text-center py-8">Nenhum registro de goleiros encontrado</p>
                </div>
            </div>
        </div>

        <!-- Hist√≥rico de Registros -->
        <div class="bg-white rounded-xl shadow-lg p-6 mt-8">
            <h3 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                üìä Hist√≥rico de Registros
            </h3>
            <div class="overflow-x-auto">
                <table class="w-full table-auto">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Data</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Aluno</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Naipe</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Turma</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Gols</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="historyTable">
                        <tr>
                            <td colspan="6" class="px-4 py-8 text-center text-gray-500">Nenhum registro encontrado</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- √Årea de Impress√£o (Oculta na tela) -->
    <div id="printArea" class="print-only">
        <div class="print-header">
            <h1>EMEF Pe Francisco Rieger - Relat√≥rio de Gols</h1>
            <h2 id="printTitle"></h2>
            <p id="printPeriod"></p>
        </div>
        
        <div id="printContent"></div>
    </div>

    <script>
        // Dados armazenados (Firebase ou localStorage)
        let goalRecords = [];
        let goalkeeperRecords = [];
        
        // Definir data atual como padr√£o
        document.getElementById('date').valueAsDate = new Date();
        document.getElementById('gkDate').valueAsDate = new Date();
        
        // Aguardar carregamento do Firebase
        setTimeout(() => {
            initializeApp();
        }, 1000);
        
        function initializeApp() {
            const { firebaseEnabled } = window.firebaseDB || {};
            
            if (!firebaseEnabled) {
                // Mostrar aviso de configura√ß√£o
                document.getElementById('firebaseWarning').style.display = 'block';
                // Carregar dados do localStorage
                loadLocalData();
            } else {
                // Carregar dados do Firebase
                loadFirebaseData();
            }
            
            populateYearFilters();
            updateDisplays();
        }
        
        // Carregar dados do localStorage
        function loadLocalData() {
            goalRecords = JSON.parse(localStorage.getItem('goalRecords')) || [];
            goalkeeperRecords = JSON.parse(localStorage.getItem('goalkeeperRecords')) || [];
        }
        
        // Carregar dados do Firebase
        async function loadFirebaseData() {
            try {
                const { db, getDocs, collection, query, orderBy } = window.firebaseDB;
                
                // Carregar gols
                const goalsQuery = query(collection(db, 'goals'), orderBy('date', 'desc'));
                const goalsSnapshot = await getDocs(goalsQuery);
                goalRecords = goalsSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Carregar goleiros
                const keepersQuery = query(collection(db, 'goalkeepers'), orderBy('date', 'desc'));
                const keepersSnapshot = await getDocs(keepersQuery);
                goalkeeperRecords = keepersSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                console.log('Dados carregados do Firebase:', goalRecords.length, 'gols,', goalkeeperRecords.length, 'goleiros');
                updateDisplays();
            } catch (error) {
                console.error('Erro ao carregar dados do Firebase:', error);
                document.getElementById('firebaseStatus').innerHTML = 'üî¥ Erro no Firebase';
                document.getElementById('firebaseStatus').className = 'text-red-600 font-medium';
            }
        }
        
        // Salvar dados
        async function saveData() {
            const { firebaseEnabled } = window.firebaseDB || {};
            
            if (firebaseEnabled) {
                // Dados j√° s√£o salvos automaticamente no Firebase
                return;
            } else {
                // Salvar no localStorage
                localStorage.setItem('goalRecords', JSON.stringify(goalRecords));
                localStorage.setItem('goalkeeperRecords', JSON.stringify(goalkeeperRecords));
            }
        }
        
        // Salvar gol no Firebase
        async function saveGoalToFirebase(record) {
            try {
                const { db, addDoc, collection } = window.firebaseDB;
                const docRef = await addDoc(collection(db, 'goals'), record);
                record.id = docRef.id;
                return record;
            } catch (error) {
                console.error('Erro ao salvar gol no Firebase:', error);
                throw error;
            }
        }
        
        // Salvar goleiro no Firebase
        async function saveGoalkeeperToFirebase(record) {
            try {
                const { db, addDoc, collection } = window.firebaseDB;
                const docRef = await addDoc(collection(db, 'goalkeepers'), record);
                record.id = docRef.id;
                return record;
            } catch (error) {
                console.error('Erro ao salvar goleiro no Firebase:', error);
                throw error;
            }
        }
        
        // Atualizar no Firebase
        async function updateInFirebase(id, data, type) {
            try {
                const { db, updateDoc, doc } = window.firebaseDB;
                const collectionName = type === 'goal' ? 'goals' : 'goalkeepers';
                await updateDoc(doc(db, collectionName, id), data);
            } catch (error) {
                console.error('Erro ao atualizar no Firebase:', error);
                throw error;
            }
        }
        
        // Excluir do Firebase
        async function deleteFromFirebase(id, type) {
            try {
                const { db, deleteDoc, doc } = window.firebaseDB;
                const collectionName = type === 'goal' ? 'goals' : 'goalkeepers';
                await deleteDoc(doc(db, collectionName, id));
            } catch (error) {
                console.error('Erro ao excluir do Firebase:', error);
                throw error;
            }
        }
        
        // Preencher anos no filtro
        function populateYearFilters() {
            const currentYear = new Date().getFullYear();
            const startYear = Math.max(2025, currentYear);
            const yearFilter = document.getElementById('filterYear');
            const printYearFilter = document.getElementById('printYearSelect');
            
            yearFilter.innerHTML = '<option value="">Todos os anos</option>';
            printYearFilter.innerHTML = '<option value="">Ano para impress√£o</option>';
            
            for (let year = startYear; year >= 2025; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearFilter.appendChild(option);
                
                const printOption = document.createElement('option');
                printOption.value = year;
                printOption.textContent = year;
                printYearFilter.appendChild(printOption);
            }
        }
        
        // Fun√ß√£o para obter trof√©u baseado na posi√ß√£o
        function getTrophy(position) {
            switch(position) {
                case 1: return '<span class="trophy-gold text-2xl">üèÜ</span>';
                case 2: return '<span class="trophy-silver text-2xl">ü•à</span>';
                case 3: return '<span class="trophy-bronze text-2xl">ü•â</span>';
                default: return '<span class="text-gray-400 text-xl">‚öΩ</span>';
            }
        }
        
        // Fun√ß√£o para formatar data
        function formatDate(dateString) {
            const date = new Date(dateString + 'T00:00:00');
            return date.toLocaleDateString('pt-BR');
        }
        
        // Fun√ß√£o para capitalizar nome
        function capitalizeName(name) {
            return name.toLowerCase().replace(/\b\w/g, l => l.toUpperCase());
        }
        
        // Registrar gols
        document.getElementById('goalForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const button = document.querySelector('#goalForm button[type="submit"]');
            const originalText = button.innerHTML;
            button.innerHTML = '‚è≥ Salvando...';
            button.disabled = true;
            
            try {
                const record = {
                    date: document.getElementById('date').value,
                    studentName: capitalizeName(document.getElementById('studentName').value.trim()),
                    gender: document.getElementById('gender').value,
                    class: document.getElementById('class').value,
                    goals: parseInt(document.getElementById('goals').value),
                    timestamp: new Date().toISOString()
                };
                
                const { firebaseEnabled } = window.firebaseDB || {};
                
                if (firebaseEnabled) {
                    const savedRecord = await saveGoalToFirebase(record);
                    goalRecords.unshift(savedRecord);
                } else {
                    record.id = Date.now();
                    goalRecords.unshift(record);
                    saveData();
                }
                
                updateDisplays();
                
                // Limpar formul√°rio
                document.getElementById('goalForm').reset();
                document.getElementById('date').valueAsDate = new Date();
                
                // Feedback visual
                button.innerHTML = '‚úÖ Registrado!';
                button.classList.add('bg-green-700');
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-green-700');
                    button.disabled = false;
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao registrar gol:', error);
                button.innerHTML = '‚ùå Erro ao salvar';
                button.classList.add('bg-red-600');
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-red-600');
                    button.disabled = false;
                }, 3000);
            }
        });

        // Registrar goleiros
        document.getElementById('goalkeeperForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const button = document.querySelector('#goalkeeperForm button[type="submit"]');
            const originalText = button.innerHTML;
            button.innerHTML = '‚è≥ Salvando...';
            button.disabled = true;
            
            try {
                const record = {
                    date: document.getElementById('gkDate').value,
                    goalkeeperName: capitalizeName(document.getElementById('goalkeeperName').value.trim()),
                    gender: document.getElementById('gkGender').value,
                    class: document.getElementById('gkClass').value,
                    goalsSuffered: parseInt(document.getElementById('goalsSuffered').value),
                    timestamp: new Date().toISOString()
                };
                
                const { firebaseEnabled } = window.firebaseDB || {};
                
                if (firebaseEnabled) {
                    const savedRecord = await saveGoalkeeperToFirebase(record);
                    goalkeeperRecords.unshift(savedRecord);
                } else {
                    record.id = Date.now();
                    goalkeeperRecords.unshift(record);
                    saveData();
                }
                
                updateDisplays();
                
                // Limpar formul√°rio
                document.getElementById('goalkeeperForm').reset();
                document.getElementById('gkDate').valueAsDate = new Date();
                
                // Feedback visual
                button.innerHTML = '‚úÖ Registrado!';
                button.classList.add('bg-blue-700');
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-blue-700');
                    button.disabled = false;
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao registrar goleiro:', error);
                button.innerHTML = '‚ùå Erro ao salvar';
                button.classList.add('bg-red-600');
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-red-600');
                    button.disabled = false;
                }, 3000);
            }
        });
        
        // Fun√ß√£o para filtrar registros
        function getFilteredRecords() {
            const genderFilter = document.getElementById('filterGender').value;
            const classFilter = document.getElementById('filterClass').value;
            const monthFilter = document.getElementById('filterMonth').value;
            const yearFilter = document.getElementById('filterYear').value;
            
            return goalRecords.filter(record => {
                const recordDate = new Date(record.date + 'T00:00:00');
                const recordMonth = recordDate.getMonth() + 1;
                const recordYear = recordDate.getFullYear();
                
                return (!genderFilter || record.gender === genderFilter) &&
                       (!classFilter || record.class === classFilter) &&
                       (!monthFilter || recordMonth.toString() === monthFilter) &&
                       (!yearFilter || recordYear.toString() === yearFilter);
            });
        }
        
        // Fun√ß√£o para criar ranking
        function createRanking(records) {
            const playerStats = {};
            
            records.forEach(record => {
                const key = `${record.studentName}-${record.gender}-${record.class}`;
                if (!playerStats[key]) {
                    playerStats[key] = {
                        name: record.studentName,
                        gender: record.gender,
                        class: record.class,
                        totalGoals: 0
                    };
                }
                playerStats[key].totalGoals += record.goals;
            });
            
            return Object.values(playerStats)
                .sort((a, b) => b.totalGoals - a.totalGoals)
                .slice(0, 10);
        }
        
        // Fun√ß√£o para renderizar ranking
        function renderRanking(ranking, containerId) {
            const container = document.getElementById(containerId);
            
            if (ranking.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhum registro encontrado</p>';
                return;
            }
            
            let html = '';
            ranking.forEach((player, index) => {
                const position = index + 1;
                const trophy = getTrophy(position);
                const genderIcon = player.gender === 'masculino' ? 'üë¶' : 'üëß';
                
                html += `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <div class="flex items-center space-x-3">
                            <div class="flex items-center space-x-2">
                                <span class="font-bold text-lg text-gray-600">${position}¬∫</span>
                                ${trophy}
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">${player.name}</p>
                                <p class="text-sm text-gray-600">${genderIcon} ${player.class} - ${player.gender}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-bold text-green-600">${player.totalGoals}</p>
                            <p class="text-sm text-gray-500">gols</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Fun√ß√£o para atualizar hist√≥rico
        function updateHistory() {
            const filteredRecords = getFilteredRecords();
            const tbody = document.getElementById('historyTable');
            
            if (filteredRecords.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-gray-500">Nenhum registro encontrado</td></tr>';
                return;
            }
            
            const sortedRecords = filteredRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let html = '';
            sortedRecords.forEach(record => {
                const genderIcon = record.gender === 'masculino' ? 'üë¶' : 'üëß';
                html += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm">${formatDate(record.date)}</td>
                        <td class="px-4 py-3 text-sm font-medium">${record.studentName}</td>
                        <td class="px-4 py-3 text-sm">${genderIcon} ${record.gender}</td>
                        <td class="px-4 py-3 text-sm">${record.class}</td>
                        <td class="px-4 py-3 text-sm font-bold text-green-600">${record.goals}</td>
                        <td class="px-4 py-3 text-sm">
                            <button onclick="editRecord('${record.id}', 'goal')" 
                                    class="text-blue-600 hover:text-blue-800 font-medium mr-3">
                                ‚úèÔ∏è Editar
                            </button>
                            <button onclick="deleteRecord('${record.id}', 'goal')" 
                                    class="text-red-600 hover:text-red-800 font-medium">
                                üóëÔ∏è Excluir
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        // Fun√ß√£o para editar registro
        function editRecord(id, type) {
            let record;
            
            if (type === 'goal') {
                record = goalRecords.find(r => r.id === id);
            } else {
                record = goalkeeperRecords.find(r => r.id === id);
            }
            
            if (!record) {
                alert('Registro n√£o encontrado!');
                return;
            }
            
            // Preencher modal de edi√ß√£o
            document.getElementById('editRecordId').value = id;
            document.getElementById('editRecordType').value = type;
            document.getElementById('editDate').value = record.date;
            document.getElementById('editGender').value = record.gender;
            document.getElementById('editClass').value = record.class;
            
            if (type === 'goal') {
                document.getElementById('editName').value = record.studentName;
                document.getElementById('editGoals').value = record.goals;
                document.getElementById('editNameLabel').textContent = 'Nome do Aluno';
                document.getElementById('editGoalsLabel').textContent = 'Quantidade de Gols';
                document.getElementById('editGoals').min = '1';
            } else {
                document.getElementById('editName').value = record.goalkeeperName;
                document.getElementById('editGoals').value = record.goalsSuffered;
                document.getElementById('editNameLabel').textContent = 'Nome do Goleiro';
                document.getElementById('editGoalsLabel').textContent = 'Gols Sofridos';
                document.getElementById('editGoals').min = '0';
            }
            
            // Mostrar modal
            document.getElementById('editModal').style.display = 'block';
        }
        
        // Fun√ß√£o para salvar edi√ß√£o
        async function saveEdit() {
            const button = document.querySelector('#editModal button[onclick="saveEdit()"]');
            const originalText = button.innerHTML;
            button.innerHTML = '‚è≥ Salvando...';
            button.disabled = true;
            
            try {
                const id = document.getElementById('editRecordId').value;
                const type = document.getElementById('editRecordType').value;
                
                const updatedData = {
                    date: document.getElementById('editDate').value,
                    gender: document.getElementById('editGender').value,
                    class: document.getElementById('editClass').value
                };
                
                if (type === 'goal') {
                    updatedData.studentName = capitalizeName(document.getElementById('editName').value.trim());
                    updatedData.goals = parseInt(document.getElementById('editGoals').value);
                } else {
                    updatedData.goalkeeperName = capitalizeName(document.getElementById('editName').value.trim());
                    updatedData.goalsSuffered = parseInt(document.getElementById('editGoals').value);
                }
                
                const { firebaseEnabled } = window.firebaseDB || {};
                
                if (firebaseEnabled) {
                    await updateInFirebase(id, updatedData, type);
                }
                
                // Atualizar array local
                if (type === 'goal') {
                    const index = goalRecords.findIndex(r => r.id === id);
                    if (index !== -1) {
                        goalRecords[index] = { ...goalRecords[index], ...updatedData };
                    }
                } else {
                    const index = goalkeeperRecords.findIndex(r => r.id === id);
                    if (index !== -1) {
                        goalkeeperRecords[index] = { ...goalkeeperRecords[index], ...updatedData };
                    }
                }
                
                if (!firebaseEnabled) {
                    saveData();
                }
                
                updateDisplays();
                closeEditModal();
                
                // Feedback visual
                button.innerHTML = '‚úÖ Salvo!';
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }, 1000);
                
            } catch (error) {
                console.error('Erro ao salvar edi√ß√£o:', error);
                button.innerHTML = '‚ùå Erro ao salvar';
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }, 3000);
                alert('Erro ao salvar altera√ß√µes. Tente novamente.');
            }
        }
        
        // Fun√ß√£o para excluir registro
        async function deleteRecord(id, type) {
            if (!confirm('Tem certeza que deseja excluir este registro?')) {
                return;
            }
            
            try {
                const { firebaseEnabled } = window.firebaseDB || {};
                
                if (firebaseEnabled) {
                    await deleteFromFirebase(id, type);
                }
                
                if (type === 'goal') {
                    goalRecords = goalRecords.filter(record => record.id !== id);
                } else {
                    goalkeeperRecords = goalkeeperRecords.filter(record => record.id !== id);
                }
                
                if (!firebaseEnabled) {
                    saveData();
                }
                
                updateDisplays();
                
            } catch (error) {
                console.error('Erro ao excluir registro:', error);
                alert('Erro ao excluir registro. Tente novamente.');
            }
        }
        
        // Fun√ß√£o para atualizar todos os displays
        function updateDisplays() {
            const filteredRecords = getFilteredRecords();
            
            // Ranking mensal
            const currentMonth = new Date().getMonth() + 1;
            const currentYear = new Date().getFullYear();
            const monthFilter = document.getElementById('filterMonth').value || currentMonth.toString();
            const yearFilter = document.getElementById('filterYear').value || currentYear.toString();
            
            const monthlyRecords = goalRecords.filter(record => {
                const recordDate = new Date(record.date + 'T00:00:00');
                return recordDate.getMonth() + 1 === parseInt(monthFilter) && 
                       recordDate.getFullYear() === parseInt(yearFilter);
            });
            
            const monthlyRanking = createRanking(monthlyRecords);
            renderRanking(monthlyRanking, 'monthlyRanking');
            
            // Ranking anual
            const annualRecords = goalRecords.filter(record => {
                const recordDate = new Date(record.date + 'T00:00:00');
                return recordDate.getFullYear() === parseInt(yearFilter);
            });
            
            const annualRanking = createRanking(annualRecords);
            renderRanking(annualRanking, 'annualRanking');
            
            // Ranking de goleiros
            const goalkeeperRanking = createGoalkeeperRanking();
            renderGoalkeeperRanking(goalkeeperRanking, 'goalkeeperRanking');
            
            // Hist√≥rico
            updateHistory();
        }

        // Fun√ß√£o para criar ranking de goleiros
        function createGoalkeeperRanking() {
            const genderFilter = document.getElementById('filterGender').value;
            const classFilter = document.getElementById('filterClass').value;
            const yearFilter = document.getElementById('filterYear').value || new Date().getFullYear().toString();
            
            const filteredRecords = goalkeeperRecords.filter(record => {
                const recordDate = new Date(record.date + 'T00:00:00');
                const recordYear = recordDate.getFullYear();
                
                return (!genderFilter || record.gender === genderFilter) &&
                       (!classFilter || record.class === classFilter) &&
                       recordYear.toString() === yearFilter;
            });
            
            const goalkeeperStats = {};
            
            filteredRecords.forEach(record => {
                const key = `${record.goalkeeperName}-${record.gender}-${record.class}`;
                if (!goalkeeperStats[key]) {
                    goalkeeperStats[key] = {
                        name: record.goalkeeperName,
                        gender: record.gender,
                        class: record.class,
                        totalGoalsSuffered: 0,
                        games: 0
                    };
                }
                goalkeeperStats[key].totalGoalsSuffered += record.goalsSuffered;
                goalkeeperStats[key].games += 1;
            });
            
            return Object.values(goalkeeperStats)
                .map(gk => ({
                    ...gk,
                    average: gk.games > 0 ? (gk.totalGoalsSuffered / gk.games).toFixed(2) : 0
                }))
                .sort((a, b) => parseFloat(a.average) - parseFloat(b.average))
                .slice(0, 10);
        }

        // Fun√ß√£o para renderizar ranking de goleiros
        function renderGoalkeeperRanking(ranking, containerId) {
            const container = document.getElementById(containerId);
            
            if (ranking.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhum registro de goleiros encontrado</p>';
                return;
            }
            
            let html = '';
            ranking.forEach((goalkeeper, index) => {
                const position = index + 1;
                const trophy = getTrophy(position);
                const genderIcon = goalkeeper.gender === 'masculino' ? 'üë¶' : 'üëß';
                
                html += `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <div class="flex items-center space-x-3">
                            <div class="flex items-center space-x-2">
                                <span class="font-bold text-lg text-gray-600">${position}¬∫</span>
                                ${trophy}
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">${goalkeeper.name}</p>
                                <p class="text-sm text-gray-600">${genderIcon} ${goalkeeper.class} - ${goalkeeper.gender}</p>
                                <p class="text-xs text-gray-500">${goalkeeper.games} jogos</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-bold text-blue-600">${goalkeeper.average}</p>
                            <p class="text-sm text-gray-500">m√©dia/jogo</p>
                            <p class="text-xs text-gray-400">${goalkeeper.totalGoalsSuffered} total</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Event listeners para filtros
        document.getElementById('filterGender').addEventListener('change', updateDisplays);
        document.getElementById('filterClass').addEventListener('change', updateDisplays);
        document.getElementById('filterMonth').addEventListener('change', updateDisplays);
        document.getElementById('filterYear').addEventListener('change', updateDisplays);
        
        // Fun√ß√µes para modal Firebase
        function showFirebaseInstructions() {
            document.getElementById('firebaseModal').style.display = 'block';
        }
        
        function closeFirebaseModal() {
            document.getElementById('firebaseModal').style.display = 'none';
        }
        
        // Fun√ß√µes para modal de edi√ß√£o
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }
        
        // Fechar modal clicando fora
        window.onclick = function(event) {
            const firebaseModal = document.getElementById('firebaseModal');
            const editModal = document.getElementById('editModal');
            
            if (event.target === firebaseModal) {
                firebaseModal.style.display = 'none';
            }
            if (event.target === editModal) {
                editModal.style.display = 'none';
            }
        }
        
        // Fun√ß√µes de impress√£o (mantidas iguais)
        function printMonthlyReport() {
            const printYear = document.getElementById('printYearSelect').value;
            if (!printYear) {
                alert('Por favor, selecione o ano para impress√£o do relat√≥rio mensal.');
                return;
            }
            
            const currentMonth = new Date().getMonth() + 1;
            const monthFilter = document.getElementById('filterMonth').value || currentMonth.toString();
            
            const monthNames = ['', 'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                              'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            generatePrintReport('Relat√≥rio Mensal', `${monthNames[parseInt(monthFilter)]} de ${printYear}`, 'monthly', printYear);
        }

        function printAnnualReport() {
            const printYear = document.getElementById('printYearSelect').value;
            if (!printYear) {
                alert('Por favor, selecione o ano para impress√£o do relat√≥rio anual.');
                return;
            }
            
            generatePrintReport('Relat√≥rio Anual', `Ano de ${printYear}`, 'annual', printYear);
        }

        function generatePrintReport(title, period, type, selectedYear) {
            // Criar nova janela para impress√£o
            const printWindow = window.open('', '_blank');
            
            // Filtrar dados baseado no tipo de relat√≥rio
            const currentMonth = new Date().getMonth() + 1;
            const monthFilter = document.getElementById('filterMonth').value || currentMonth.toString();
            const yearFilter = selectedYear;
            
            let goalData, goalkeeperData;
            
            if (type === 'monthly') {
                goalData = goalRecords.filter(record => {
                    const recordDate = new Date(record.date + 'T00:00:00');
                    return recordDate.getMonth() + 1 === parseInt(monthFilter) && 
                           recordDate.getFullYear() === parseInt(yearFilter);
                });
                
                goalkeeperData = goalkeeperRecords.filter(record => {
                    const recordDate = new Date(record.date + 'T00:00:00');
                    return recordDate.getMonth() + 1 === parseInt(monthFilter) && 
                           recordDate.getFullYear() === parseInt(yearFilter);
                });
            } else {
                goalData = goalRecords.filter(record => {
                    const recordDate = new Date(record.date + 'T00:00:00');
                    return recordDate.getFullYear() === parseInt(yearFilter);
                });
                
                goalkeeperData = goalkeeperRecords.filter(record => {
                    const recordDate = new Date(record.date + 'T00:00:00');
                    return recordDate.getFullYear() === parseInt(yearFilter);
                });
            }
            
            // Criar HTML para impress√£o
            let printHTML = `
                <!DOCTYPE html>
                <html lang="pt-BR">
                <head>
                    <meta charset="UTF-8">
                    <title>${title} - EMEF Pe Francisco Rieger</title>
                    <style>
                        @page {
                            size: A4 landscape;
                            margin: 1cm;
                        }
                        
                        body {
                            font-family: Arial, sans-serif;
                            font-size: 12px;
                            line-height: 1.4;
                            color: #000;
                            margin: 0;
                            padding: 0;
                        }
                        
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            border-bottom: 2px solid #000;
                            padding-bottom: 15px;
                        }
                        
                        .header h1 {
                            font-size: 18px;
                            margin: 0 0 5px 0;
                            font-weight: bold;
                        }
                        
                        .header h2 {
                            font-size: 16px;
                            margin: 0 0 5px 0;
                        }
                        
                        .header p {
                            font-size: 12px;
                            margin: 0;
                            color: #666;
                        }
                        
                        .section {
                            margin-bottom: 25px;
                            page-break-inside: avoid;
                        }
                        
                        .section h3 {
                            font-size: 14px;
                            margin: 0 0 10px 0;
                            padding: 8px;
                            background-color: #f0f0f0;
                            border: 1px solid #ccc;
                            font-weight: bold;
                        }
                        
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 15px;
                        }
                        
                        th, td {
                            border: 1px solid #000;
                            padding: 6px 8px;
                            text-align: left;
                            font-size: 11px;
                        }
                        
                        th {
                            background-color: #e0e0e0;
                            font-weight: bold;
                        }
                        
                        .trophy {
                            font-size: 14px;
                        }
                        
                        .no-data {
                            text-align: center;
                            font-style: italic;
                            color: #666;
                            padding: 20px;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>EMEF Pe Francisco Rieger</h1>
                        <h2>${title}</h2>
                        <p>${period} - Gerado em ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}</p>
                    </div>
            `;
            
            // Ranking de Goleadores
            const goalRanking = createRanking(goalData);
            printHTML += '<div class="section">';
            printHTML += '<h3>üèÜ Ranking de Goleadores</h3>';
            
            if (goalRanking.length > 0) {
                printHTML += '<table>';
                printHTML += '<thead><tr><th>Posi√ß√£o</th><th>Nome</th><th>Naipe</th><th>Turma</th><th>Total de Gols</th></tr></thead>';
                printHTML += '<tbody>';
                
                goalRanking.forEach((player, index) => {
                    const trophy = index < 3 ? ['üèÜ', 'ü•à', 'ü•â'][index] : '';
                    printHTML += `<tr>
                        <td>${index + 1}¬∫ <span class="trophy">${trophy}</span></td>
                        <td><strong>${player.name}</strong></td>
                        <td>${player.gender}</td>
                        <td>${player.class}</td>
                        <td><strong>${player.totalGoals}</strong></td>
                    </tr>`;
                });
                
                printHTML += '</tbody></table>';
            } else {
                printHTML += '<div class="no-data">Nenhum registro de gols encontrado para este per√≠odo</div>';
            }
            
            printHTML += '</div>';
            
            // Ranking de Goleiros
            const gkStats = {};
            goalkeeperData.forEach(record => {
                const key = `${record.goalkeeperName}-${record.gender}-${record.class}`;
                if (!gkStats[key]) {
                    gkStats[key] = {
                        name: record.goalkeeperName,
                        gender: record.gender,
                        class: record.class,
                        totalGoalsSuffered: 0,
                        games: 0
                    };
                }
                gkStats[key].totalGoalsSuffered += record.goalsSuffered;
                gkStats[key].games += 1;
            });
            
            const goalkeeperRanking = Object.values(gkStats)
                .map(gk => ({
                    ...gk,
                    average: gk.games > 0 ? (gk.totalGoalsSuffered / gk.games).toFixed(2) : 0
                }))
                .sort((a, b) => parseFloat(a.average) - parseFloat(b.average));
            
            printHTML += '<div class="section">';
            printHTML += '<h3>ü•Ö Ranking de Goleiros Menos Vazados</h3>';
            
            if (goalkeeperRanking.length > 0) {
                printHTML += '<table>';
                printHTML += '<thead><tr><th>Posi√ß√£o</th><th>Nome</th><th>Naipe</th><th>Turma</th><th>Jogos</th><th>Gols Sofridos</th><th>M√©dia/Jogo</th></tr></thead>';
                printHTML += '<tbody>';
                
                goalkeeperRanking.forEach((goalkeeper, index) => {
                    const trophy = index < 3 ? ['üèÜ', 'ü•à', 'ü•â'][index] : '';
                    printHTML += `<tr>
                        <td>${index + 1}¬∫ <span class="trophy">${trophy}</span></td>
                        <td><strong>${goalkeeper.name}</strong></td>
                        <td>${goalkeeper.gender}</td>
                        <td>${goalkeeper.class}</td>
                        <td>${goalkeeper.games}</td>
                        <td>${goalkeeper.totalGoalsSuffered}</td>
                        <td><strong>${goalkeeper.average}</strong></td>
                    </tr>`;
                });
                
                printHTML += '</tbody></table>';
            } else {
                printHTML += '<div class="no-data">Nenhum registro de goleiros encontrado para este per√≠odo</div>';
            }
            
            printHTML += '</div>';
            
            // Hist√≥rico detalhado de gols
            printHTML += '<div class="section">';
            printHTML += '<h3>‚öΩ Hist√≥rico Detalhado de Gols Marcados</h3>';
            
            if (goalData.length > 0) {
                printHTML += '<table>';
                printHTML += '<thead><tr><th>Data</th><th>Aluno</th><th>Naipe</th><th>Turma</th><th>Gols Marcados</th></tr></thead>';
                printHTML += '<tbody>';
                
                goalData.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(record => {
                    printHTML += `<tr>
                        <td>${formatDate(record.date)}</td>
                        <td>${record.studentName}</td>
                        <td>${record.gender}</td>
                        <td>${record.class}</td>
                        <td><strong>${record.goals}</strong></td>
                    </tr>`;
                });
                
                printHTML += '</tbody></table>';
            } else {
                printHTML += '<div class="no-data">Nenhum registro de gols encontrado para este per√≠odo</div>';
            }
            
            printHTML += '</div>';
            
            // Hist√≥rico detalhado de goleiros
            if (goalkeeperData.length > 0) {
                printHTML += '<div class="section">';
                printHTML += '<h3>ü•Ö Hist√≥rico Detalhado de Goleiros</h3>';
                printHTML += '<table>';
                printHTML += '<thead><tr><th>Data</th><th>Goleiro</th><th>Naipe</th><th>Turma</th><th>Gols Sofridos</th></tr></thead>';
                printHTML += '<tbody>';
                
                goalkeeperData.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(record => {
                    printHTML += `<tr>
                        <td>${formatDate(record.date)}</td>
                        <td>${record.goalkeeperName}</td>
                        <td>${record.gender}</td>
                        <td>${record.class}</td>
                        <td><strong>${record.goalsSuffered}</strong></td>
                    </tr>`;
                });
                
                printHTML += '</tbody></table></div>';
            }
            
            // Rodap√© com cr√©ditos
            printHTML += `
                <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ccc; text-align: center;">
                    <p style="font-size: 10px; color: #666; font-style: italic; margin: 0;">
                        Desenvolvido pelo Professor Leandro Ludwig
                    </p>
                </div>
            `;
            
            printHTML += '</body></html>';
            
            // Escrever HTML na nova janela
            printWindow.document.write(printHTML);
            printWindow.document.close();
            
            // Aguardar carregamento e imprimir
            printWindow.onload = function() {
                setTimeout(() => {
                    printWindow.print();
                }, 500);
            };
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9767ae41458e4f4a',t:'MTc1NjQyNDcwOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
